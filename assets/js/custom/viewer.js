/**
*	@author: LÃ©on de Jong
*/
!function(i,t,s){"use strict";function e(i){this.initialize(i)}var n=!1;e.prototype={constructor:e,container:null,visual:null,nextVisual:-1,previousVisual:0,direction:0,intention:0,running:!1,shifting:!1,hidden:!0,select:!1,defaults:{element:"body",file:"data.json",directory:"",selector:"img",target:"href",data:[],entry:"file",classPrefix:"viewer-",containerClass:"container",visualClass:"visual",nextClass:"next",previousClass:"previous",closeClass:"close",overlayClass:"overlay",activeClass:"active",visualDuration:.3,resizeDuration:.3,shiftDelay:2,maxWidth:7680,maxHeight:4320,verticalOffset:60,horizontalOffset:60,overlayOpacity:.5,userInterface:!1,cssBackground:!1,resizeContainer:!1,shiftRandom:!1,shiftBackwards:!1,disposeOnClose:!1,flip:!1,controls:!0,callback:function(){}},initialize:function(i){this.options=i||{},this.dispatcher=t("<div></div>"),this.select="string"==typeof this.options.selector,this.mobile=/iphone|ipad|ipod|android|windows *phone/i.test(navigator.userAgent),this.assign(),this.setup(),this.get()},assign:function(i){i=this.object("defaults",i);for(var t in i)i.hasOwnProperty(t)&&"undefined"==typeof this[t]&&this["default"](t,typeof i[t],i[t])},"default":function(i,t,s,e){e=this.object("options",e),this[i]=typeof e[i]===t?e[i]:s},object:function(i,t){return"object"==typeof t?t:"object"==typeof this[i]?this[i]:{}},get:function(){if(this.data instanceof Array&&this.data.length>0)this.execute(this.data);else if(this.select){var i=[];this.elements=this.elements||t(this.selector),this.elements.each(function(s,e){var e=t(e);i.push({file:e.data(this.target)}),e.data("index",s)}.bind(this)),this.execute(i)}else this.fetch(this.file,this.execute.bind(this))},execute:function(i){"string"==typeof i&&(i=t.parseJSON(i)),i instanceof Array&&(this.data=i),"function"==typeof this.callback&&this.callback(this,this.data)},fetch:function(i,s){i="string"==typeof i?i:this.file,s="function"==typeof s?s:function(i){console.log(i)},t.getJSON(i,s)},refresh:function(i){this.constructor.call(this,i)},setup:function(){this.select&&(this.elements=this.elements||t(this.selector),this.elements.on("click",this.activate.bind(this)),this.elements.css({cursor:"pointer"})),this.element=t(this.element),this.hidden=!0,this.container=t("<div>",{"class":this.classPrefix+this.containerClass,style:"display: none; opacity: 0;"});var i=this.cssBackground?"<div>":"<img>",s=t(i,{"class":this.classPrefix+this.visualClass,style:"display: none; opacity: 0; z-index: 2;"}),e=t(i,{"class":this.classPrefix+this.visualClass+" "+this.classPrefix+this.activeClass,style:"display: block; opacity: 1; z-index: 3;"});this.element.append(this.container.append(s,e)),this.userInterface&&this["interface"](),this.resizeContainer&&t(window).on("resize",this.resize.bind(this)),this.controls&&t(window).on("keydown",this.onKey.bind(this)),this.trigger("setup")},"interface":function(){var i=t("<div>",{"class":this.classPrefix+this.overlayClass,style:"opacity: 0; z-index: 0;"}),e=t("<div>",{"class":this.classPrefix+this.nextClass,style:"cursor: pointer; z-index: 4;"}),n=t("<div>",{"class":this.classPrefix+this.previousClass,style:"cursor: pointer; z-index: 4;"}),h=t("<div>",{"class":this.classPrefix+this.closeClass,style:"cursor: pointer; z-index: 4;"});e.on("click",this.next.bind(this)),n.on("click",this.previous.bind(this)),h.on("click",this.close.bind(this)),i.on("click",this.close.bind(this)),this.container.prepend(i),this.container.append(e,n,h);var i=t("."+this.classPrefix+this.overlayClass);s.to(i,this.visualDuration,{opacity:this.overlayOpacity,ease:Linear.easeNone}),this.trigger("interface")},next:function(){this.shifting||(-1===this.nextVisual?this.intention=0:this.intention=1,this.previousVisual=this.nextVisual,this.shiftRandom?(this.nextVisual=this.randomIndex(),this.nextVisual>this.previousVisual?this.direction=1:this.nextVisual<this.previousVisual?this.direction=-1:this.direction=0,"first"===this.shiftRandom&&(this.shiftRandom=!1)):++this.nextVisual>=this.data.length?(this.direction=-1,this.nextVisual=0):this.direction=1,this.load(),this.trigger("next"))},previous:function(){this.shifting||(-1===this.nextVisual?this.intention=0:this.intention=-1,this.previousVisual=this.nextVisual,this.shiftRandom?(this.nextVisual=this.randomIndex(),this.nextVisual>this.previousVisual?this.direction=1:this.nextVisual<this.previousVisual?this.direction=-1:this.direction=0,"first"===this.shiftRandom&&(this.shiftRandom=!1)):--this.nextVisual<0?(this.direction=1,this.nextVisual=this.data.length-1):this.direction=-1,this.load(),this.trigger("previous"))},"goto":function(i){this.intention=0,this.nextVisual!==i?(this.previousVisual=this.nextVisual,this.nextVisual=i,this.nextVisual>this.previousVisual?this.direction=1:this.nextVisual<this.previousVisual?this.direction=-1:this.direction=0,this.load()):this.show()},load:function(i,t){i="string"==typeof i?i:this.directory+this.data[this.nextVisual][this.entry],t="function"==typeof t?t:this.exchange.bind(this),this.visual=new Image,this.visual.src=i,this.visual.onload=t,this.trigger("load")},exchange:function(){function i(){s.to(o,f,{opacity:0,rotationY:l,transformPerspective:3e3,ease:u,onComplete:n.bind(this)})}function e(){s.to(r,d,{opacity:1,rotationY:0,transformPerspective:3e3,ease:c,onComplete:function(){o.css({opacity:0,display:"none"}),this.shifting=!1,this.trigger("ready")}.bind(this)})}function n(){if(this.flip)var i=a.width/this.container.width(),t=Math.abs(i-1)*this.resizeDuration*2;else var t=this.resizeDuration;s.to(this.container,t,{width:a.width,height:a.height,ease:Back.easeOut,onComplete:e.bind(this)})}function h(){this.container.css({width:a.width,height:a.height,onComplete:e.bind(this)}),o.css({opacity:0,display:"none"}),r.css({opacity:1,display:"block"}),e.call(this)}this.shifting=!0,this.hidden=!1;var a=this.dimensions(),o=t("."+this.classPrefix+this.visualClass+"."+this.classPrefix+this.activeClass),r=t("."+this.classPrefix+this.visualClass+":not(."+this.classPrefix+this.activeClass+")");if(this.flip&&this.intention>0)var l=90;else if(this.flip&&this.intention<0)var l=-90;else var l=0;if(this.flip)var c=Back.easeOut,u=Cubic.easeIn,d=2*this.visualDuration,f=this.visualDuration;else var c=Linear.easeNone,u=Linear.easeNone,d=this.visualDuration,f=this.visualDuration;s.set(o,{rotationY:0,zIndex:2}),o.removeClass(this.classPrefix+this.activeClass),s.set(r,{rotationY:-l,display:"block",opacity:0,zIndex:3}),r.addClass(this.classPrefix+this.activeClass),this.container.css({display:"block"}),s.to(this.container,this.visualDuration,{opacity:1,ease:Linear.easeNone}),this.cssBackground?r.css("background-image","url("+this.visual.src+")"):r.attr("src",this.visual.src),this.cssBackground&&!this.flip?e.call(this):this.resizeContainer||this.cssBackground?i.call(this):h.call(this),this.trigger("visual",{visual:this.visual})},shift:function(){this.running&&(this.shiftBackwards?this.previous():this.next(),this.delay(),this.trigger("shift"))},delay:function(i){if(i="function"==typeof i?i:this.shift,this.resizeContainer)var t=2*this.visualDuration+this.resizeDuration+this.shiftDelay;else var t=this.visualDuration+this.shiftDelay;setTimeout(i.bind(this),1e3*t),this.trigger("delay")},start:function(){this.data.length<2||this.running||(this.running=!0,this.nextVisual<0&&this.next(),this.hidden&&this.show(),this.delay(),this.trigger("start"))},stop:function(){this.running=!1,this.trigger("stop")},show:function(){this.hidden&&(this.hidden=!1,this.nextVisual<0?this.next():s.to(this.container,this.visualDuration,{opacity:1,ease:Linear.easeNone,onStart:function(){this.container.css({display:"block"})}.bind(this),onComplete:function(){this.unsub(),this.trigger("ready")}.bind(this)}),this.trigger("show"))},hide:function(){this.hidden||(this.hidden=!0,s.to(this.container,this.visualDuration,{opacity:0,ease:Linear.easeNone,onComplete:function(){this.container.css({display:"none"})}.bind(this)}),this.trigger("hide"))},close:function(){this.unsub(),this.hide(),this.disposeOnClose&&setTimeout(this.dispose.bind(this),1e3*this.visualDuration),this.trigger("close")},activate:function(i){i.preventDefault();var s=t(i.currentTarget);this.size(s)},size:function(i){function e(i){function e(){function i(){this.resizeContainer=t,this.unsub(),this.off("ready.restore close.restore")}var t=this.resizeContainer;this.resizeContainer=!1,this.on("ready.restore close.restore",i.bind(this)),this["goto"](r),this.trigger("size")}var l=this.dimensions(this.visual);if(this.flip)var c=0,u=-360,d=0;else var c=0,u=0,d=0;s.set(this.sub,{rotationX:c,rotationY:u,rotationZ:d}),this.sub.css({position:"fixed",top:n,left:h,width:a,height:o,margin:0,padding:0,border:"none",zoom:"100%"}),t("body").append(this.sub),s.to(this.sub,this.resizeDuration,{top:l.y,left:l.x,width:l.width,height:l.height,opacity:1,rotationX:0,rotationY:0,rotationZ:0,transformPerspective:3e3,ease:Cubic.easeOut,onComplete:e.bind(this)})}if(this.sub)return void this.unsub();this.sub=i.clone();var n=i.offset().top-t(window).scrollTop(),h=i.offset().left-t(window).scrollLeft(),a=i.width(),o=i.height(),r=i.data("index");this.load(this.sub.attr("src"),e.bind(this))},dimensions:function(i){var s,e,n=t(window).width(),h=t(window).height();if(i instanceof Image)var a=i.width,o=i.height;else{if(!(this.visual instanceof Image))return!1;var a=this.visual.width,o=this.visual.height}var r=n-2*this.horizontalOffset,l=h-2*this.verticalOffset,c=this.maxWidth,u=this.maxHeight,d=a/o,f=n/h;d>f?a>r?(s=Math.min(r,c),e=s/d):(e=Math.min(o,u),s=e*d):o>l?(e=Math.min(l,u),s=e*d):(s=Math.min(a,c),e=s/d);var p=(n-s)/2,g=(h-e)/2;return{x:parseInt(p),y:parseInt(g),width:parseInt(s),height:parseInt(e)}},resize:function(){if(!this.shifting&&this.resizeContainer){var i=this.dimensions();this.container.css({width:i.width,height:i.height}),this.trigger("resize")}},unsub:function(){this.sub&&(this.sub.remove(),this.sub=null)},on:function(){this.dispatcher instanceof t&&this.dispatcher.on.apply(this.dispatcher,arguments)},off:function(){this.dispatcher instanceof t&&this.dispatcher.off.apply(this.dispatcher,arguments)},trigger:function(){this.dispatcher instanceof t&&(this.dispatcher.trigger("all"),this.dispatcher.trigger.apply(this.dispatcher,arguments))},onKey:function(i){"keydown"!==i.type||this.hidden||((39===i.keyCode||40===i.keyCode||13===i.keyCode||32===i.keyCode||187===i.keyCode)&&(i.preventDefault(),this.next()),(37===i.keyCode||38===i.keyCode||8===i.keyCode||189===i.keyCode)&&(i.preventDefault(),this.previous()),27===i.keyCode&&(i.preventDefault(),this.close()))},randomIndex:function(){var i=Math.floor(Math.random()*this.data.length);return i===this.nextVisual?this.randomIndex():i},isRunning:function(){return this.running},isShifting:function(){return this.shifting},isHidden:function(){return this.hidden},dispose:function(){t(window).off("resize",this.resize),this.unsub(),this.off(),this.container.remove();for(var i in this)this.hasOwnProperty(i)&&delete this[i];this.trigger("dispose")}};(function(){n&&console.log.apply(console,arguments)}).bind(this);return i.Viewer=function(i){var t=new e(i);this.start=function(){t.start.apply(t,arguments)},this.stop=function(){t.stop.apply(t,arguments)},this.show=function(){t.show.apply(t,arguments)},this.hide=function(){t.hide.apply(t,arguments)},this.close=function(){t.close.apply(t,arguments)},this.next=function(){t.next.apply(t,arguments)},this.previous=function(){t.previous.apply(t,arguments)},this["goto"]=function(){t["goto"].apply(t,arguments)},this.isRunning=function(){t.isRunning.apply(t,arguments)},this.isShifting=function(){t.isShifting.apply(t,arguments)},this.isHidden=function(){t.isHidden.apply(t,arguments)},this.on=function(){t.on.apply(t,arguments)},this.off=function(){t.off.apply(t,arguments)},this.trigger=function(){t.trigger.apply(t,arguments)},this.dispose=function(){t.dispose.apply(t,arguments)}},i.Viewer}(window,$,TweenLite);